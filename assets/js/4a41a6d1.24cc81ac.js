"use strict";(self.webpackChunklastmile_docs=self.webpackChunklastmile_docs||[]).push([[8151],{2253:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var a=n(74848),s=n(28453);n(4865),n(19365),n(79402);const i={id:"experiments",title:"Experiments"},r="Experimentation",l={id:"autoeval/experiments",title:"Experiments",description:"Track and manage experiments on your LLMs and applications to compare performance, test changes, and validate improvements.",source:"@site/docs/autoeval/experiments.mdx",sourceDirName:"autoeval",slug:"/autoeval/experiments",permalink:"/autoeval/experiments",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"experiments",title:"Experiments"},sidebar:"sidebar",previous:{title:"Fine-tune Evaluators",permalink:"/autoeval/fine-tune"},next:{title:"Evaluator Models",permalink:"/autoeval/models"}},o={},d=[{value:"What is an Experiment?",id:"what-is-an-experiment",level:2},{value:"What types of changes can Experiments measure?",id:"what-types-of-changes-can-experiments-measure",level:2},{value:"Usage Guide",id:"usage-guide",level:2},{value:"1. Set Up AutoEval Client",id:"1-set-up-autoeval-client",level:3},{value:"Authenticate with the LastMile AI API",id:"authenticate-with-the-lastmile-ai-api",level:4},{value:"Set Up AutoEval Client",id:"set-up-autoeval-client",level:3},{value:"2. Create a Project or Select an Existing Project",id:"2-create-a-project-or-select-an-existing-project",level:3},{value:"3. Prepare and Upload Your Dataset",id:"3-prepare-and-upload-your-dataset",level:3},{value:"Uploading a new dataset",id:"uploading-a-new-dataset",level:4},{value:"4. Create an Experiment",id:"4-create-an-experiment",level:3},{value:"5. Evaluate the Dataset Against Built-in Metrics",id:"5-evaluate-the-dataset-against-built-in-metrics",level:3},{value:"6. Visualize in the Experiments Console",id:"6-visualize-in-the-experiments-console",level:3}];function c(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"experimentation",children:"Experimentation"})}),"\n",(0,a.jsx)(t.p,{children:"Track and manage experiments on your LLMs and applications to compare performance, test changes, and validate improvements."}),"\n",(0,a.jsx)(t.h2,{id:"what-is-an-experiment",children:"What is an Experiment?"}),"\n",(0,a.jsxs)(t.p,{children:["An ",(0,a.jsx)(t.em,{children:"Experiment"})," is a collection of ",(0,a.jsx)(t.em,{children:"evaluation runs"}),". Each ",(0,a.jsx)(t.em,{children:"evaluation run"})," consists of the ",(0,a.jsx)(t.em,{children:"dataset"})," and ",(0,a.jsx)(t.em,{children:"metrics"})," for that run. For example, let's say I have a dataset of customer support chatbot questions, answers, and context. For my ",(0,a.jsx)(t.em,{children:"Customer Support Experiment"}),", I can run this dataset against AutoEval's ",(0,a.jsx)(t.em,{children:"relevancy"}),", ",(0,a.jsx)(t.em,{children:"toxicity"}),", and ",(0,a.jsx)(t.em,{children:"faithfulness"})," metrics as an ",(0,a.jsx)(t.em,{children:"evaluation run"}),". Next, I can update the model (let's say to Gemini) for the chatbot and generate new answers and context for the same set of questions. Then, I can save that as another ",(0,a.jsx)(t.em,{children:"evaluation run"})," and compare the results to determine if the model change was a positive improvement."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://andrew-dev-s3.s3.us-east-1.amazonaws.com/Experiments-Diagram.png",alt:"Experiments Diagram"})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Experiments"})," enable you to confidently make iterative changes to your LLM application in a structured and organzied way."]}),"\n",(0,a.jsx)(t.h2,{id:"what-types-of-changes-can-experiments-measure",children:"What types of changes can Experiments measure?"}),"\n",(0,a.jsx)(t.p,{children:"Anything that influences the LLM application's performance is measureable through an experiment, such as:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["Updates to the ",(0,a.jsx)(t.strong,{children:"LLM model"}),", such as a new training date"]}),"\n",(0,a.jsxs)(t.li,{children:["Modifying the ",(0,a.jsx)(t.strong,{children:"retrieval strategy"})," for a ",(0,a.jsx)(t.strong,{children:"RAG system"})]}),"\n",(0,a.jsxs)(t.li,{children:["Adjusting ",(0,a.jsx)(t.strong,{children:"system prompts"})," for an agent"]}),"\n",(0,a.jsx)(t.li,{children:"And more"}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"Here are the recommended metadata to track for your LLM application:"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{}),(0,a.jsx)(t.th,{children:"model"}),(0,a.jsx)(t.th,{children:"chunk_size"}),(0,a.jsx)(t.th,{children:"chunk_strategy"}),(0,a.jsx)(t.th,{children:"top_k_retrieval"}),(0,a.jsx)(t.th,{children:"dataset"}),(0,a.jsx)(t.th,{children:"temperature"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Example 1"}),(0,a.jsx)(t.td,{children:"gpt-4o-2024-08-06"}),(0,a.jsx)(t.td,{children:"1024"}),(0,a.jsx)(t.td,{children:"sliding window"}),(0,a.jsx)(t.td,{children:"5"}),(0,a.jsx)(t.td,{children:"question-answer-v1"}),(0,a.jsx)(t.td,{children:"0"})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"Example 2"}),(0,a.jsx)(t.td,{children:"gemini-2.0-flash-001"}),(0,a.jsx)(t.td,{children:"512"}),(0,a.jsx)(t.td,{children:"no overlap"}),(0,a.jsx)(t.td,{children:"5"}),(0,a.jsx)(t.td,{children:"question-answer-v1"}),(0,a.jsx)(t.td,{children:"0"})]})]})]}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsx)(t.p,{children:"For saving metadata around the model, make sure to include the entire version, which includes the cutoff of the train date. Model providers are constantly updating the latest model with new data, as such it's a good practice to pin the model version on the one that works best for you."})}),"\n",(0,a.jsx)(t.h2,{id:"usage-guide",children:"Usage Guide"}),"\n",(0,a.jsx)(t.p,{children:"This guide walks through the process of setting up and running experiments using AutoEval, including:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Setting up the API key"})," and ",(0,a.jsx)(t.strong,{children:"creating a project"})]}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.strong,{children:"Preparing and uploading a dataset"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.strong,{children:"Creating an Experiment"})}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Evaluating the dataset"})," against default metrics, logging results, and iterating on changes"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Visualizing the results"})," in the Experiments Console"]}),"\n"]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"1-set-up-autoeval-client",children:"1. Set Up AutoEval Client"}),"\n",(0,a.jsx)(t.p,{children:"Before running experiments, ensure you have the latest version of AutoEval:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"pip install lastmile --upgrade\n"})}),"\n",(0,a.jsx)(t.h4,{id:"authenticate-with-the-lastmile-ai-api",children:"Authenticate with the LastMile AI API"}),"\n",(0,a.jsxs)(t.p,{children:["To interact with the ",(0,a.jsx)(t.strong,{children:"LastMile AI API"}),", set your API key as an environment variable."]}),"\n",(0,a.jsxs)(t.p,{children:["\ud83d\udccc ",(0,a.jsx)(t.strong,{children:"Tip:"})," If you don't have an API key yet, visit the ",(0,a.jsx)(t.strong,{children:"LastMile AI dashboard"}),", navigate to the ",(0,a.jsx)(t.strong,{children:"API section"})," on the sidebar, and copy your key."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'import os\n\napi_token = "YOUR_API_KEY_HERE"\n\nif not api_token:\n    print("Error: Please set your API key in the environment variable LASTMILE_API_KEY")\nelse:\n    print("\u2713 API key successfully configured!")\n'})}),"\n",(0,a.jsx)(t.h3,{id:"set-up-autoeval-client",children:"Set Up AutoEval Client"}),"\n",(0,a.jsxs)(t.p,{children:["Once authenticated, initialize the ",(0,a.jsx)(t.strong,{children:"AutoEval client"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:"from lastmile.lib.auto_eval import AutoEval\nclient = AutoEval(api_token=api_token)  # Optionally set project_id to scope to a specific project\n"})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"2-create-a-project-or-select-an-existing-project",children:"2. Create a Project or Select an Existing Project"}),"\n",(0,a.jsxs)(t.p,{children:["A ",(0,a.jsx)(t.strong,{children:"Project"})," is the container that organizes your ",(0,a.jsx)(t.strong,{children:"Experiments, Evaluation runs, and Datasets"}),". It typically corresponds to the ",(0,a.jsx)(t.strong,{children:"AI initiative, application, or use case"})," you\u2019re building."]}),"\n",(0,a.jsx)(t.p,{children:"Projects help keep evaluations structured, especially when managing multiple experiments across different AI models or applications. You can create new projects or use existing ones."}),"\n",(0,a.jsx)(t.p,{children:"To create a new project programmatically, use:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'project = client.create_project(\n    name="Example Customer Agent Project", \n    description="Example project to evaluate customer support agents"\n)\n\nclient.project_id = project.id\n'})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"3-prepare-and-upload-your-dataset",children:"3. Prepare and Upload Your Dataset"}),"\n",(0,a.jsx)(t.p,{children:"You can either use an existing dataset or upload a new dataset to run an evaluation within your new experiment. For an existing dataset, you can skip to Step 4."}),"\n",(0,a.jsx)(t.h4,{id:"uploading-a-new-dataset",children:"Uploading a new dataset"}),"\n",(0,a.jsxs)(t.p,{children:["LastMile AI AutoEval expects a ",(0,a.jsx)(t.strong,{children:"CSV file"})," with the following columns:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:(0,a.jsx)(t.code,{children:"input"})}),": The user's query or input text"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:(0,a.jsx)(t.code,{children:"output"})}),": The assistant's response to the user's query"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:(0,a.jsx)(t.code,{children:"ground_truth"})})," ",(0,a.jsx)(t.em,{children:"(optional)"}),": The correct or expected response for comparison. This can also be the context for metrics like ",(0,a.jsx)(t.em,{children:"faithfulness"})]}),"\n"]}),"\n",(0,a.jsxs)(t.p,{children:["Uploading this dataset allows you to evaluate how well the assistant's responses align with the ",(0,a.jsx)(t.strong,{children:"ground truth"})," using LastMile AI\u2019s evaluation metrics."]}),"\n",(0,a.jsx)(t.p,{children:"To upload your dataset, use the following code:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'dataset_csv_path = "ADD_YOUR_DATASET_HERE"\n\ndataset_id = client.upload_dataset(\n    file_path=dataset_csv_path,\n    name="NAME_OF_YOUR_DATASET",\n    description="DESCRIPTION_OF_DATASET"\n)\n\nprint(f"Dataset created with ID: {dataset_id}")\n'})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"4-create-an-experiment",children:"4. Create an Experiment"}),"\n",(0,a.jsx)(t.p,{children:"To create an experiment, use the following code:"}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsx)(t.p,{children:"The experiment's metadata should be used to track important information (or parameters) in regards to the application that is being tested. Important metadata to track include the LLM being used, the LLM parameters, prompt version, dataset version, the application, etc."})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'experiment = client.create_experiment(\n    name="EXPERIMENT_NAME",\n    description="EXPERIMENT_DESCRIPTION",\n    metadata={\n        "model": "gpt-4o", \n        "temperature": 0.8, \n        "misc": {\n            "dataset_version": "0.1.1", \n            "app": "customer-support"\n        }\n    }\n)\n'})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"5-evaluate-the-dataset-against-built-in-metrics",children:"5. Evaluate the Dataset Against Built-in Metrics"}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsx)(t.p,{children:"You can specify custom and fine-tuned metrics to be evaluated for that dataset."})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-python",children:'from lastmile.lib.auto_eval import BuiltinMetrics\n\ndefault_metrics = [\n    BuiltinMetrics.FAITHFULNESS,\n    BuiltinMetrics.RELEVANCE,\n]\n\nprint("Evaluation job kicked off")\n\nevaluation_results = client.evaluate_dataset(\n    dataset_id=dataset_id,\n    metrics=default_metrics,\n    experiment_id=experiment.id,\n    metadata={"extras": "Base metric tests"}\n)\n\nprint("Evaluation Results:")\nevaluation_results.head(10)\n'})}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.h3,{id:"6-visualize-in-the-experiments-console",children:"6. Visualize in the Experiments Console"}),"\n",(0,a.jsxs)(t.p,{children:["\ud83d\udcca ",(0,a.jsx)(t.strong,{children:"Explore your results in the AutoEval UI:"})]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\ud83d\udd2c ",(0,a.jsx)(t.strong,{children:"Experiments Overview:"})," ",(0,a.jsx)(t.a,{href:"https://lastmileai.dev/evaluations?view=experiments",children:"View all experiments"})]}),"\n",(0,a.jsxs)(t.li,{children:["\ud83d\udcc8 ",(0,a.jsx)(t.strong,{children:"Evaluation Runs:"})," ",(0,a.jsx)(t.a,{href:"https://lastmileai.dev/evaluations?view=all_runs",children:"See all evaluation runs"})]}),"\n",(0,a.jsxs)(t.li,{children:["\ud83c\udfe2 ",(0,a.jsx)(t.strong,{children:"Project Dashboard:"})," ",(0,a.jsx)(t.a,{href:"https://lastmileai.dev/dashboard",children:"Manage projects and experiments"})]}),"\n",(0,a.jsxs)(t.li,{children:["\ud83d\udcc2 ",(0,a.jsx)(t.strong,{children:"Dataset Library:"})," ",(0,a.jsx)(t.a,{href:"https://lastmileai.dev/datasets",children:"Browse and manage uploaded datasets"})]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsxs)(t.strong,{children:["Check out the ",(0,a.jsx)(t.a,{href:"https://github.com/lastmile-ai/lastmile-docs/blob/main/cookbook/AutoEval_Experiments.ipynb",children:"full cookbook"})," for expanded details on the functionality"]})})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},79402:(e,t,n)=>{var a=n(38193);!!a.default.canUseDOM&&navigator.platform.startsWith("Mac"),!!a.default.canUseDOM&&navigator.platform.startsWith("Win")},4865:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(96540),s=n(18215),i=n(23104),r=n(47751),l=n(92303);const o={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var d=n(74848);function c(e){let{className:t,block:n,selectedValue:a,selectValue:r,tabValues:l}=e;const c=[],{blockElementScrollPositionUntilNextRender:h}=(0,i.a_)(),p=e=>{const t=e.currentTarget,n=c.indexOf(t),s=l[n].value;s!==a&&(h(t),r(s))},u=e=>{let t=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return(0,d.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},t),children:l.map((e=>{let{value:t,label:n,attributes:i}=e;return(0,d.jsx)("li",{role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,ref:e=>c.push(e),onKeyDown:u,onClick:p,...i,className:(0,s.A)("tabs__item",o.tabItem,i?.className,{"tabs__item--active":a===t}),children:n??t},t)}))})}function h(e){let{lazy:t,children:n,selectedValue:i}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===i));return e?(0,a.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,d.jsx)("div",{className:"margin-top--md",children:r.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function p(e){const t=(0,r.u)(e);return(0,d.jsxs)("div",{className:(0,s.A)("tabs-container",o.tabList),children:[(0,d.jsx)(c,{...t,...e}),(0,d.jsx)(h,{...t,...e})]})}function u(e){const t=(0,l.default)();return(0,d.jsx)(p,{...e,children:(0,r.v)(e.children)},String(t))}}}]);